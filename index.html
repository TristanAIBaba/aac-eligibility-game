<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The AAC Eligibility Game: Can You Get Specialist Referral?</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .screen {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2, h3 {
            color: #FF00FF;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.5em;
            text-align: center;
        }

        h2 {
            font-size: 2em;
        }

        .narrator {
            font-style: italic;
            color: #555;
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-left: 4px solid #FF00FF;
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .character-card {
            background: linear-gradient(to bottom, #f9f9f9, #fff);
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .character-card:hover {
            transform: translateY(-5px);
            border-color: #FF00FF;
            box-shadow: 0 10px 30px rgba(255, 0, 255, 0.2);
        }

        .character-card h3 {
            color: #FF00FF;
            margin-bottom: 10px;
        }

        .eligibility-metre {
            background: #f0f0f0;
            border-radius: 20px;
            height: 40px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .eligibility-fill {
            height: 100%;
            background: linear-gradient(to right, #ff4444, #ffaa44, #44ff44);
            transition: width 0.5s ease;
            border-radius: 20px;
        }

        .eligibility-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: #FF00FF;
            font-size: 1.2em;
        }

        .dialogue-box {
            background: #f9f9f9;
            border-left: 4px solid #003D7A;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .dialogue-box.miss-smith {
            border-left-color: #003D7A;
        }

        .dialogue-box.family {
            border-left-color: #FF00FF;
        }

        .speaker {
            font-weight: bold;
            color: #003D7A;
            margin-bottom: 5px;
        }

        .speaker.family {
            color: #FF00FF;
        }

        button {
            background: #FF00FF;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        button:hover {
            background: #cc00cc;
            transform: scale(1.05);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .mini-game {
            background: #f0f0ff;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .video-option {
            background: white;
            border: 2px solid #ddd;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .video-option:hover {
            border-color: #FF00FF;
        }

        .video-option.selected {
            background: #FF00FF;
            color: white;
            border-color: #FF00FF;
        }

        .touchscreen-game {
            position: relative;
            width: 100%;
            height: 400px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
        }

        .target {
            position: absolute;
            width: 60px;
            height: 60px;
            background: #FF00FF;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .target:hover {
            transform: scale(1.1);
        }

        .timer {
            font-size: 2em;
            color: #FF00FF;
            text-align: center;
            margin: 20px 0;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #FF00FF;
            position: absolute;
            animation: confetti-fall 3s linear;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .win-screen, .lose-screen {
            text-align: center;
        }

        .win-screen h2 {
            color: #44ff44;
            font-size: 3em;
        }

        .lose-screen h2 {
            color: #ff4444;
            font-size: 3em;
        }

        .images-container {
            text-align: center;
            margin: 20px 0;
        }

        .images-container img {
            max-width: 100%;
            height: auto;
            margin: 10px;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 10px;
            }

            .screen {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .character-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen active">
            <h1>The AAC Eligibility Game: Can You Get Specialist Referral?</h1>
            
            <div class="narrator">
                Welcome to the AAC Eligibility Game, where the points are made up and the barriers are real. In this game, you'll navigate the NHS England AAC Decision Chart - the same form speech and language therapists actually use to decide if people deserve specialist communication equipment.
            </div>

            <div class="narrator">
                You can play as one of seven perspectives. Six people trying to get referred to a specialist AAC service. Or Miss Smith, the SLT trying to apply the system. Fair warning: most will fail. The system is stacked against them. Want to see why? Pick your perspective.
            </div>

            <h2>Select Your Perspective:</h2>

            <div class="character-grid">
                <div class="character-card" onclick="selectCharacter('mia')">
                    <h3>Mia</h3>
                    <p>8-year-old girl with cerebral palsy. Uses a picture board. Mum translates her gestures.</p>
                </div>

                <div class="character-card" onclick="selectCharacter('james')">
                    <h3>James</h3>
                    <p>30-year-old man with MND. Uses an alphabet board. Wife helps spell out messages. Time is running out.</p>
                </div>

                <div class="character-card" onclick="selectCharacter('robert')">
                    <h3>Robert</h3>
                    <p>65-year-old. Had a stroke three months ago. Very few people get specialist AAC shortly after stroke - doctors assume he'll recover his speech.</p>
                </div>

                <div class="character-card" onclick="selectCharacter('aisha')">
                    <h3>Aisha</h3>
                    <p>25-year-old woman with autism and intellectual disability. No AAC at all. Local SLT has never offered her anything.</p>
                </div>

                <div class="character-card" onclick="selectCharacter('kwame')">
                    <h3>Kwame</h3>
                    <p>19-year-old with severe CP. Had a great AAC device five years ago. Device broke eight months ago and is still waiting for replacement.</p>
                </div>

                <div class="character-card" onclick="selectCharacter('mrs_chen')">
                    <h3>Mrs. Chen</h3>
                    <p>72-year-old with severe dysarthria. Speaks Cantonese at home. No bilingual speech therapist available. Her son tries to help but isn't trained.</p>
                </div>

                <div class="character-card" onclick="selectCharacter('miss_smith')">
                    <h3>Miss Smith (SLT Mode)</h3>
                    <p>The Speech and Language Therapist trying to apply the Decision Chart fairly. Watch as she assesses patient after patient and realises the system is broken.</p>
                </div>
            </div>

            <div class="images-container">
                <img src="images/kate_and_tristan_cartoon_transparent_background.png" alt="Kate and Trist√°n" style="max-width: 300px;">
                <p><a href="https://www.unspokenvoices.co.uk" target="_blank" style="color: #FF00FF;">Visit The Power of Unspoken Voices</a></p>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="images-container">
                <img src="images/logo-nhs.png" alt="NHS Logo" style="max-width: 150px;">
                <img src="images/2025_NHS_Decision_Chart_AAC.png" alt="NHS Decision Chart" style="max-width: 400px; cursor: pointer;" onclick="enlargeChart()">
            </div>

            <h2 id="character-name"></h2>
            
            <div class="eligibility-metre">
                <div class="eligibility-fill" id="eligibility-fill"></div>
                <div class="eligibility-text" id="eligibility-text">0%</div>
            </div>

            <div id="question-container"></div>
            
            <div id="mini-game-container"></div>

            <div id="dialogue-container"></div>

            <div style="text-align: center; margin-top: 30px;">
                <button id="next-button" onclick="nextQuestion()" style="display: none;">Next Question</button>
            </div>
        </div>

        <!-- Win Screen -->
        <div id="win-screen" class="screen win-screen">
            <h2>üéâ CONGRATULATIONS! üéâ</h2>
            <h3>You Navigated the System!</h3>
            <p>You reached <span id="final-eligibility"></span>% eligibility and have been referred to specialist AAC services.</p>
            
            <div id="confetti-container"></div>

            <div class="narrator">
                You made it through the hoops. But ask yourself: should it be this hard? Should getting communication equipment require jumping through so many barriers?
            </div>

            <p><a href="https://www.unspokenvoices.co.uk" target="_blank" style="color: #FF00FF; font-size: 1.2em;">Learn more about AAC reform at The Power of Unspoken Voices</a></p>

            <button onclick="resetGame()">Try Another Character</button>
        </div>

        <!-- Lose Screen -->
        <div id="lose-screen" class="screen lose-screen">
            <h2>üíî YOU FELL THROUGH THE CRACKS üíî</h2>
            <p>Final eligibility: <span id="lose-eligibility"></span>%</p>
            
            <div class="narrator">
                The system rejected you. Not because you don't need AAC. But because the barriers are stacked too high. This happens to real people every day.
            </div>

            <div id="barrier-explanation"></div>

            <p><a href="https://www.unspokenvoices.co.uk" target="_blank" style="color: #FF00FF; font-size: 1.2em;">Help reform this broken system at The Power of Unspoken Voices</a></p>

            <button onclick="resetGame()">Try Another Character</button>
        </div>
    </div>

    <script>
        // GAME STATE - Initialize FIRST
        const game = {
            currentCharacter: null,
            eligibility: 0,
            currentQuestion: 0,
            selectedVideos: [],
            touchscreenTaps: 0
        };

        // CHARACTER DATA
        const characters = {
            mia: {
                name: "Mia",
                familyMember: "Mum",
                startingEligibility: 100,
                questions: [
                    {
                        text: "Do you understand cause and effect? For example, if I press this button, the light comes on?",
                        speaker: "Miss Smith",
                        response: "Mia points to symbols on her board showing she understands.",
                        familyResponse: "She definitely understands. She combines symbols all the time.",
                        familySpeaker: "Mum",
                        outcome: 10
                    },
                    {
                        text: "Can you show me that you understand what a communication device is for?",
                        speaker: "Miss Smith",
                        response: "Mia gestures toward her picture board and points to 'talk' symbol.",
                        familyResponse: "She wants to communicate more than just basic needs.",
                        familySpeaker: "Mum",
                        outcome: 10
                    },
                    {
                        text: "I need video evidence showing a clear gap between understanding and ability to speak. Do you have recent videos?",
                        speaker: "Miss Smith",
                        miniGame: "videoHunt",
                        goodVideos: ["School demonstration", "Family dinner"],
                        okayVideos: ["Birthday party"],
                        badVideos: ["Holiday photos", "Medical appointment"],
                        outcome: 15
                    },
                    {
                        text: "Have you tried low-tech AAC strategies? I need documentation showing why they're insufficient.",
                        speaker: "Miss Smith",
                        response: "Mia's picture board is shown. She combines multiple symbols but it's slow and limiting.",
                        familyResponse: "The board works for basic needs, but she wants to tell stories, make jokes, express complex ideas. The board can't keep up with her mind.",
                        familySpeaker: "Mum",
                        outcome: 15
                    },
                    {
                        text: "Can you use a touchscreen or keyboard with at least one hand?",
                        speaker: "Miss Smith",
                        miniGame: "touchscreen",
                        difficulty: "hard",
                        successThreshold: 3,
                        outcome: 20
                    },
                    {
                        text: "Do you have a dedicated support team who understands your communication needs?",
                        speaker: "Miss Smith",
                        response: "Mia has consistent SLT support, school involvement, and Mum coordinates everything.",
                        familyResponse: "We have brilliant support from her school SLT and the local service has been involved from the start.",
                        familySpeaker: "Mum",
                        outcome: 15
                    }
                ]
            },
            james: {
                name: "James",
                familyMember: "Wife",
                startingEligibility: 120,
                questions: [
                    {
                        text: "Do you understand cause and effect?",
                        speaker: "Miss Smith",
                        response: "James grunts affirmatively.",
                        familyResponse: "He understands everything perfectly. His mind is completely intact.",
                        familySpeaker: "Wife",
                        outcome: 10
                    },
                    {
                        text: "Do you understand what a communication device is for?",
                        speaker: "Miss Smith",
                        response: "James grunts again and looks frustrated.",
                        familyResponse: "He desperately wants to communicate. He has so much to say.",
                        familySpeaker: "Wife",
                        outcome: 10
                    },
                    {
                        text: "Do you have video evidence of the communication gap?",
                        speaker: "Miss Smith",
                        miniGame: "videoHunt",
                        goodVideos: ["Family dinner"],
                        okayVideos: ["Birthday party", "Holiday photos"],
                        badVideos: ["Medical appointment"],
                        outcome: 5
                    },
                    {
                        text: "Have you tried low-tech AAC? Why isn't it enough?",
                        speaker: "Miss Smith",
                        miniGame: "alphabetBoard",
                        outcome: 15
                    },
                    {
                        text: "Can you use a touchscreen?",
                        speaker: "Miss Smith",
                        miniGame: "touchscreen",
                        difficulty: "impossible",
                        successThreshold: 0,
                        outcome: 20
                    },
                    {
                        text: "Do you have a support team?",
                        speaker: "Miss Smith",
                        response: "James has his wife and some SLT involvement.",
                        familyResponse: "I coordinate everything. The MND team is involved too.",
                        familySpeaker: "Wife",
                        outcome: 15
                    }
                ]
            },
            robert: {
                name: "Robert",
                familyMember: "Daughter",
                startingEligibility: 80,
                questions: [
                    {
                        text: "Do you understand cause and effect?",
                        speaker: "Miss Smith",
                        response: "Robert nods clearly.",
                        familyResponse: "He understands everything. It's just the speaking that's affected.",
                        familySpeaker: "Daughter",
                        outcome: 10
                    },
                    {
                        text: "Do you understand what a communication device is for?",
                        speaker: "Miss Smith",
                        response: "Robert nods and looks frustrated.",
                        familyResponse: "He's so frustrated that he can't express himself.",
                        familySpeaker: "Daughter",
                        outcome: 10
                    },
                    {
                        text: "Do you have video evidence?",
                        speaker: "Miss Smith",
                        miniGame: "videoHunt",
                        goodVideos: [],
                        okayVideos: ["Family dinner"],
                        badVideos: ["Holiday photos", "Medical appointment", "Birthday party"],
                        outcome: 5
                    },
                    {
                        text: "Have you tried low-tech AAC strategies first?",
                        speaker: "Miss Smith",
                        response: "Robert hasn't tried any AAC yet - stroke was only 3 months ago.",
                        familyResponse: "Nobody offered us anything. We didn't know where to start.",
                        familySpeaker: "Daughter",
                        outcome: -15
                    },
                    {
                        text: "Can you use a touchscreen?",
                        speaker: "Miss Smith",
                        miniGame: "touchscreen",
                        difficulty: "medium",
                        successThreshold: 5,
                        outcome: -30
                    },
                    {
                        text: "Do you have a support team?",
                        speaker: "Miss Smith",
                        response: "Robert's daughter is trying, but no dedicated SLT yet.",
                        familyResponse: "I'm doing my best, but I don't really know what I'm doing.",
                        familySpeaker: "Daughter",
                        outcome: -10
                    }
                ]
            },
            aisha: {
                name: "Aisha",
                familyMember: "Mother",
                startingEligibility: 70,
                questions: [
                    {
                        text: "Can you show me that you understand cause and effect?",
                        speaker: "Miss Smith",
                        response: "Aisha becomes anxious during the assessment. She makes sounds but cannot demonstrate clearly.",
                        familyResponse: "She understands! I can see it. But she can't show you the way you want.",
                        familySpeaker: "Mother",
                        outcome: -15
                    },
                    {
                        text: "Can you show me you understand what a communication device is for?",
                        speaker: "Miss Smith",
                        response: "Aisha cannot communicate her understanding without AAC.",
                        familyResponse: "But she NEEDS AAC to show you she understands AAC! It's impossible!",
                        familySpeaker: "Mother",
                        outcome: -20
                    },
                    {
                        text: "Do you have video evidence?",
                        speaker: "Miss Smith",
                        miniGame: "videoHunt",
                        goodVideos: [],
                        okayVideos: [],
                        badVideos: ["Family dinner", "Birthday party", "Holiday photos"],
                        outcome: -25
                    },
                    {
                        text: "Has she tried low-tech AAC?",
                        speaker: "Miss Smith",
                        response: "Aisha has never been offered any AAC at all.",
                        familyResponse: "Nobody ever offered her anything. They said she wouldn't understand.",
                        familySpeaker: "Mother",
                        outcome: -20
                    },
                    {
                        text: "Can she use a touchscreen?",
                        speaker: "Miss Smith",
                        miniGame: "touchscreen",
                        difficulty: "medium",
                        successThreshold: 4,
                        outcome: -30
                    },
                    {
                        text: "Does she have a support team?",
                        speaker: "Miss Smith",
                        response: "Aisha has no professional support coordinating her care.",
                        familyResponse: "It's just me. The local SLT doesn't seem interested.",
                        familySpeaker: "Mother",
                        outcome: -20
                    }
                ]
            },
            kwame: {
                name: "Kwame",
                familyMember: "Father",
                startingEligibility: 110,
                questions: [
                    {
                        text: "Do you understand cause and effect?",
                        speaker: "Miss Smith",
                        response: "Kwame gestures clearly showing understanding.",
                        familyResponse: "He's used AAC for five years. Of course he understands.",
                        familySpeaker: "Father",
                        outcome: 10
                    },
                    {
                        text: "Do you understand what a communication device is for?",
                        speaker: "Miss Smith",
                        response: "Kwame points to where his broken device used to be.",
                        familyResponse: "He had a device. He knows exactly what it's for. He's lost without it.",
                        familySpeaker: "Father",
                        outcome: 10
                    },
                    {
                        text: "Do you have video evidence?",
                        speaker: "Miss Smith",
                        miniGame: "videoHunt",
                        goodVideos: ["School demonstration", "Family dinner"],
                        okayVideos: ["Birthday party"],
                        badVideos: [],
                        outcome: 15
                    },
                    {
                        text: "Have you tried low-tech AAC?",
                        speaker: "Miss Smith",
                        response: "Kwame used a high-tech device for 5 years. It's well documented.",
                        familyResponse: "We have five years of reports showing low-tech isn't enough for him.",
                        familySpeaker: "Father",
                        outcome: 15
                    },
                    {
                        text: "Can you use a touchscreen?",
                        speaker: "Miss Smith",
                        miniGame: "touchscreen",
                        difficulty: "impossible",
                        successThreshold: 0,
                        outcome: 20
                    },
                    {
                        text: "Do you have a support team?",
                        speaker: "Miss Smith",
                        response: "Kwame has excellent support: father, school, and continuity from previous AAC service.",
                        familyResponse: "We've had brilliant support. Everyone's on board.",
                        familySpeaker: "Father",
                        outcome: 15
                    }
                ]
            },
            mrs_chen: {
                name: "Mrs. Chen",
                familyMember: "Son",
                startingEligibility: 50,
                questions: [
                    {
                        text: "Does your mother understand cause and effect?",
                        speaker: "Miss Smith",
                        response: "Mrs. Chen responds in Cantonese. Meaning is partially lost in son's translation.",
                        familyResponse: "Um... she says yes? I think she understands.",
                        familySpeaker: "Son",
                        outcome: 10
                    },
                    {
                        text: "Does she understand what a communication device is for?",
                        speaker: "Miss Smith",
                        response: "Mrs. Chen speaks in Cantonese. Son struggles to translate her full intent.",
                        familyResponse: "She wants to... talk to us? Tell us things?",
                        familySpeaker: "Son",
                        outcome: 10
                    },
                    {
                        text: "Do you have video evidence?",
                        speaker: "Miss Smith",
                        miniGame: "videoHunt",
                        goodVideos: [],
                        okayVideos: [],
                        badVideos: ["Family dinner", "Holiday photos"],
                        outcome: -25
                    },
                    {
                        text: "Has she tried low-tech AAC?",
                        speaker: "Miss Smith",
                        response: "Mrs. Chen has English picture cards, but she speaks Cantonese.",
                        familyResponse: "They gave her English cards. She can't read English very well.",
                        familySpeaker: "Son",
                        outcome: -15
                    },
                    {
                        text: "Can she use a touchscreen?",
                        speaker: "Miss Smith",
                        miniGame: "touchscreen",
                        difficulty: "hard",
                        successThreshold: 2,
                        outcome: 20
                    },
                    {
                        text: "Does she have a trained support team?",
                        speaker: "Miss Smith",
                        miniGame: "translationTelephone",
                        outcome: -25
                    }
                ]
            },
            miss_smith: {
                name: "Miss Smith (SLT Perspective)",
                mode: "slt",
                description: "Under construction - Experience the system from the professional's perspective as Miss Smith assesses multiple patients and realises the system is broken."
            }
        };

        // SELECT CHARACTER
        function selectCharacter(charId) {
            const char = characters[charId];
            
            if (char.mode === 'slt') {
                alert("Miss Smith SLT mode is under construction in this version. Please select one of the patient perspectives.");
                return;
            }

            game.currentCharacter = char;
            game.eligibility = char.startingEligibility;
            game.currentQuestion = 0;
            
            showScreen('game-screen');
            document.getElementById('character-name').textContent = char.name + " with " + char.familyMember;
            updateEligibility();
            displayQuestion();
        }

        // UPDATE ELIGIBILITY METRE
        function updateEligibility() {
            const eligibility = Math.max(0, Math.min(200, game.eligibility));
            const fillPercent = (eligibility / 200) * 100;
            
            document.getElementById('eligibility-fill').style.width = fillPercent + '%';
            document.getElementById('eligibility-text').textContent = Math.round(eligibility) + '%';
        }

        // DISPLAY QUESTION
        function displayQuestion() {
            const question = game.currentCharacter.questions[game.currentQuestion];
            if (!question) {
                endGame();
                return;
            }

            const container = document.getElementById('question-container');
            const dialogueContainer = document.getElementById('dialogue-container');
            const miniGameContainer = document.getElementById('mini-game-container');
            
            container.innerHTML = `<h3>Question ${game.currentQuestion + 1} of ${game.currentCharacter.questions.length}</h3>`;
            dialogueContainer.innerHTML = '';
            miniGameContainer.innerHTML = '';

            // Miss Smith asks question
            addDialogue("Miss Smith", question.text, 'miss-smith');

            if (question.miniGame) {
                document.getElementById('next-button').style.display = 'none';
                loadMiniGame(question);
            } else {
                // Show character response
                if (question.response) {
                    setTimeout(() => {
                        addDialogue(game.currentCharacter.name, question.response, 'character');
                    }, 1000);
                }

                // Show family member response
                if (question.familyResponse) {
                    setTimeout(() => {
                        addDialogue(question.familySpeaker, question.familyResponse, 'family');
                    }, 2000);
                }

                // Update eligibility
                setTimeout(() => {
                    game.eligibility += question.outcome;
                    updateEligibility();
                    document.getElementById('next-button').style.display = 'inline-block';
                }, 3000);
            }
        }

        // ADD DIALOGUE
        function addDialogue(speaker, text, type) {
            const dialogueContainer = document.getElementById('dialogue-container');
            const dialogueBox = document.createElement('div');
            dialogueBox.className = 'dialogue-box ' + type;
            dialogueBox.innerHTML = `
                <div class="speaker ${type === 'family' ? 'family' : ''}">${speaker}:</div>
                <div>${text}</div>
            `;
            dialogueContainer.appendChild(dialogueBox);
        }

        // LOAD MINI GAME
        function loadMiniGame(question) {
            const container = document.getElementById('mini-game-container');

            if (question.miniGame === 'videoHunt') {
                loadVideoHuntGame(question);
            } else if (question.miniGame === 'touchscreen') {
                loadTouchscreenGame(question);
            } else if (question.miniGame === 'alphabetBoard') {
                loadAlphabetBoardGame(question);
            } else if (question.miniGame === 'translationTelephone') {
                loadTranslationGame(question);
            }
        }

        // VIDEO HUNT MINI GAME
        function loadVideoHuntGame(question) {
            const container = document.getElementById('mini-game-container');
            game.selectedVideos = [];

            const videos = [
                ...question.goodVideos.map(v => ({name: v, quality: 'good'})),
                ...question.okayVideos.map(v => ({name: v, quality: 'okay'})),
                ...question.badVideos.map(v => ({name: v, quality: 'bad'}))
            ];

            container.innerHTML = `
                <div class="mini-game">
                    <h3>üì± Video Evidence Hunt</h3>
                    <p>Find videos that show the communication gap. Select 3 videos:</p>
                    <div class="timer" id="video-timer">60</div>
                    <div class="video-grid" id="video-grid"></div>
                    <button onclick="submitVideos()" id="submit-videos" disabled>Submit Selected Videos</button>
                </div>
            `;

            const grid = document.getElementById('video-grid');
            videos.forEach(video => {
                const option = document.createElement('div');
                option.className = 'video-option';
                option.textContent = 'üìπ ' + video.name;
                option.onclick = () => selectVideo(video, option);
                grid.appendChild(option);
            });

            // Timer
            let timeLeft = 60;
            const timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('video-timer').textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    submitVideos();
                }
            }, 1000);
        }

        function selectVideo(video, element) {
            if (game.selectedVideos.length >= 3 && !game.selectedVideos.includes(video)) {
                return;
            }

            if (game.selectedVideos.includes(video)) {
                game.selectedVideos = game.selectedVideos.filter(v => v !== video);
                element.classList.remove('selected');
            } else {
                game.selectedVideos.push(video);
                element.classList.add('selected');
            }

            document.getElementById('submit-videos').disabled = game.selectedVideos.length !== 3;
        }

        function submitVideos() {
            const question = game.currentCharacter.questions[game.currentQuestion];
            
            let goodCount = game.selectedVideos.filter(v => v.quality === 'good').length;
            let okayCount = game.selectedVideos.filter(v => v.quality === 'okay').length;

            let outcome;
            if (goodCount >= 2) {
                outcome = question.outcome; // Full positive outcome
                addDialogue("Miss Smith", "These videos show a clear communication gap. Good evidence.", "miss-smith");
            } else if (goodCount === 1 || okayCount >= 2) {
                outcome = Math.floor(question.outcome / 3); // Partial positive outcome
                addDialogue("Miss Smith", "Some of these are helpful, but I'd like more clinical documentation.", "miss-smith");
            } else {
                outcome = question.outcome; // Negative outcome (question.outcome is already negative for some characters)
                addDialogue("Miss Smith", "These videos don't really show what I need. I need more clinical evidence.", "miss-smith");
            }

            game.eligibility += outcome;
            updateEligibility();
            
            document.getElementById('mini-game-container').innerHTML = '';
            document.getElementById('next-button').style.display = 'inline-block';
        }

        // TOUCHSCREEN MINI GAME
        function loadTouchscreenGame(question) {
            const container = document.getElementById('mini-game-container');
            game.touchscreenTaps = 0;

            container.innerHTML = `
                <div class="mini-game">
                    <h3>üì± Touchscreen Access Test</h3>
                    <p>Tap as many targets as you can in 30 seconds:</p>
                    <div class="timer" id="touchscreen-timer">30</div>
                    <div>Taps: <span id="tap-count">0</span></div>
                    <div class="touchscreen-game" id="touchscreen-game"></div>
                </div>
            `;

            const gameArea = document.getElementById('touchscreen-game');
            
            // Spawn targets
            const spawnTarget = () => {
                const target = document.createElement('div');
                target.className = 'target';
                
                const maxX = gameArea.clientWidth - 60;
                const maxY = gameArea.clientHeight - 60;
                
                let x = Math.random() * maxX;
                let y = Math.random() * maxY;

                // Adjust difficulty
                if (question.difficulty === 'hard') {
                    // Targets move
                    const moveInterval = setInterval(() => {
                        x += (Math.random() - 0.5) * 20;
                        y += (Math.random() - 0.5) * 20;
                        x = Math.max(0, Math.min(maxX, x));
                        y = Math.max(0, Math.min(maxY, y));
                        target.style.left = x + 'px';
                        target.style.top = y + 'px';
                    }, 200);
                    target.dataset.moveInterval = moveInterval;
                } else if (question.difficulty === 'impossible') {
                    // Targets out of reach
                    y = -100;
                }

                target.style.left = x + 'px';
                target.style.top = y + 'px';

                target.onclick = () => {
                    game.touchscreenTaps++;
                    document.getElementById('tap-count').textContent = game.touchscreenTaps;
                    target.remove();
                    spawnTarget();
                };

                gameArea.appendChild(target);
            };

            // Spawn initial targets
            for (let i = 0; i < 5; i++) {
                spawnTarget();
            }

            // Timer
            let timeLeft = 30;
            const timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('touchscreen-timer').textContent = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endTouchscreenGame(question);
                }
            }, 1000);
        }

        function endTouchscreenGame(question) {
            document.getElementById('touchscreen-game').innerHTML = '';
            
            // CRITICAL FIX: Reverse the logic
            // If they CAN'T tap many targets (disability prevents it), they PASS and get POSITIVE outcome
            // If they CAN tap many targets, they FAIL (local services sufficient) and get NEGATIVE outcome
            
            if (game.touchscreenTaps < question.successThreshold) {
                // FAILED touchscreen test = PASSED eligibility criterion (needs specialist)
                addDialogue("Miss Smith", "You cannot reliably use a touchscreen. You'll need an alternative access method. That's specialist territory.", "miss-smith");
                game.eligibility += question.outcome; // This is POSITIVE (e.g., +20)
            } else {
                // SUCCEEDED at touchscreen = FAILED eligibility (local services can help)
                addDialogue("Miss Smith", "You can use a touchscreen. Local services should be able to help with touchscreen-based AAC.", "miss-smith");
                game.eligibility += (question.outcome * -1.5); // Make this NEGATIVE
            }

            updateEligibility();
            document.getElementById('mini-game-container').innerHTML = '';
            document.getElementById('next-button').style.display = 'inline-block';
        }

        // ALPHABET BOARD MINI GAME
        function loadAlphabetBoardGame(question) {
            const container = document.getElementById('mini-game-container');
            
            container.innerHTML = `
                <div class="mini-game">
                    <h3>üî§ Alphabet Board Spelling</h3>
                    <p>Spell "HELP" using the alphabet board. Click each letter as the pointer reaches it.</p>
                    <div style="font-size: 2em; text-align: center; margin: 20px 0;">
                        Current word: <span id="spelled-word"></span>_
                    </div>
                    <div style="font-size: 1.5em; text-align: center; margin: 20px 0;">
                        Scanning: <span id="current-letter" style="color: #FF00FF;">A</span>
                    </div>
                    <button onclick="selectLetter()" style="font-size: 1.5em;">SELECT THIS LETTER</button>
                </div>
            `;

            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
            const targetWord = 'HELP';
            let currentLetterIndex = 0;
            let spelledWord = '';

            const scanInterval = setInterval(() => {
                currentLetterIndex = (currentLetterIndex + 1) % letters.length;
                document.getElementById('current-letter').textContent = letters[currentLetterIndex];
            }, 500);

            window.selectLetter = () => {
                const letter = letters[currentLetterIndex];
                if (letter === targetWord[spelledWord.length]) {
                    spelledWord += letter;
                    document.getElementById('spelled-word').textContent = spelledWord;

                    if (spelledWord === targetWord) {
                        clearInterval(scanInterval);
                        addDialogue(game.currentCharacter.familyMember, "That took over 2 minutes to spell one word. Imagine doing this for every conversation.", "family");
                        addDialogue("Miss Smith", "Clearly this method is too slow for your needs.", "miss-smith");
                        
                        game.eligibility += question.outcome;
                        updateEligibility();
                        
                        document.getElementById('mini-game-container').innerHTML = '';
                        document.getElementById('next-button').style.display = 'inline-block';
                    }
                }
            };
        }

        // TRANSLATION TELEPHONE MINI GAME
        function loadTranslationGame(question) {
            const container = document.getElementById('mini-game-container');
            
            container.innerHTML = `
                <div class="mini-game">
                    <h3>üåê Translation Telephone</h3>
                    <p>Mrs. Chen tries to explain her communication goals through her son's translation.</p>
                </div>
            `;

            setTimeout(() => {
                addDialogue("Mrs. Chen", "[Speaking in Cantonese: ÊàëÊÉ≥ÂëäË®¥ÊàëÁöÑÂÆ∂‰∫∫ÊàëÊÑõ‰ªñÂÄëÔºåÂàÜ‰∫´Êàë‰∏ÄÁîüÁöÑÊïÖ‰∫ã]", "character");
            }, 1000);

            setTimeout(() => {
                addDialogue(game.currentCharacter.familyMember, "Um... she wants to... communicate?", "family");
            }, 2500);

            setTimeout(() => {
                addDialogue("Miss Smith", "About what? Daily needs? Do you want help asking for food or water?", "miss-smith");
            }, 4000);

            setTimeout(() => {
                addDialogue(game.currentCharacter.familyMember, "No, I think... more about her life? I'm not sure exactly.", "family");
            }, 5500);

            setTimeout(() => {
                addDialogue("Miss Smith", "We really need a bilingual speech therapist for this assessment, but we don't have one available in this area. Without clear communication goals, this makes specialist referral very difficult.", "miss-smith");
                
                game.eligibility += question.outcome;
                updateEligibility();
                
                document.getElementById('mini-game-container').innerHTML = '';
                document.getElementById('next-button').style.display = 'inline-block';
            }, 7500);
        }

        // NEXT QUESTION
        function nextQuestion() {
            game.currentQuestion++;
            displayQuestion();
        }

        // END GAME
        function endGame() {
            if (game.eligibility >= 100) {
                // WIN
                showScreen('win-screen');
                document.getElementById('final-eligibility').textContent = Math.round(game.eligibility);
                
                // Confetti
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + '%';
                        confetti.style.animationDelay = Math.random() * 2 + 's';
                        document.getElementById('confetti-container').appendChild(confetti);
                    }, i * 100);
                }
            } else {
                // LOSE
                showScreen('lose-screen');
                document.getElementById('lose-eligibility').textContent = Math.round(game.eligibility);
                
                // Explain what went wrong
                const barriers = [];
                game.currentCharacter.questions.forEach((q, i) => {
                    if (q.outcome < 0) {
                        barriers.push(`Question ${i + 1}: ${q.text} (${q.outcome} points)`);
                    }
                });

                document.getElementById('barrier-explanation').innerHTML = `
                    <h3>What Went Wrong:</h3>
                    <ul>
                        ${barriers.map(b => '<li>' + b + '</li>').join('')}
                    </ul>
                    <p>These barriers are systemic, not personal failures.</p>
                `;
            }
        }

        // RESET GAME
        function resetGame() {
            game.currentCharacter = null;
            game.eligibility = 0;
            game.currentQuestion = 0;
            showScreen('welcome-screen');
        }

        // SHOW SCREEN
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        // ENLARGE CHART
        function enlargeChart() {
            window.open('images/2025_NHS_Decision_Chart_AAC.png', '_blank');
        }
    </script>
</body>
</html>
