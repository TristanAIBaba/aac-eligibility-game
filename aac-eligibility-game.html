<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The AAC Eligibility Game: Can You Get Specialist Referral?</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .screen {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s ease-in;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1, h2 {
            color: #FF00FF;
            margin-bottom: 20px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(255,0,255,0.3);
        }

        h2 {
            font-size: 2em;
        }

        .narrator {
            background: #f0f0f0;
            padding: 20px;
            border-left: 5px solid #FF00FF;
            margin: 20px 0;
            border-radius: 5px;
            font-style: italic;
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .character-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 3px solid transparent;
        }

        .character-card:hover, .character-card:focus {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(255,0,255,0.4);
            border-color: #FF00FF;
            outline: none;
        }

        .character-name {
            color: #FF00FF;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .character-desc {
            color: white;
            font-size: 1em;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #FF00FF;
            font-weight: bold;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px 5px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn:hover, .btn:focus {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,0,255,0.4);
            outline: 2px solid #FF00FF;
        }

        .btn-primary {
            background: #FF00FF;
            color: white;
        }

        .office-scene {
            background: #8a8a8a;
            border-radius: 10px;
            padding: 40px;
            padding-top: 120px;
            margin: 20px 0;
            position: relative;
            min-height: 400px;
            border: 3px solid #666;
        }

        .office-scene.specialist {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-color: #FF00FF;
        }

        .nhs-logo {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 120px;
            height: auto;
            transform: rotate(-5deg);
        }

        .decision-chart {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 180px;
            height: auto;
            border: 2px solid #003D7A;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s;
            background: white;
        }

        .decision-chart:hover {
            transform: scale(1.05);
        }

        .eligibility-metre {
            background: #ddd;
            height: 30px;
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
            border: 2px solid #FF00FF;
        }

        .metre-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff0000 0%, #ffff00 50%, #00ff00 100%);
            transition: width 0.5s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .question-box {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #003D7A;
        }

        .dialogue {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #FF00FF;
        }

        .speaker {
            color: #FF00FF;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .mini-game {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
            color: white;
        }

        .hoop {
            width: 200px;
            height: 200px;
            border: 15px solid gold;
            border-radius: 50%;
            margin: 30px auto;
            position: relative;
            animation: wobble 2s infinite;
        }

        @keyframes wobble {
            0%, 100% { transform: rotate(-2deg); }
            50% { transform: rotate(2deg); }
        }

        .confetti {
            position: fixed;
            top: -10px;
            width: 10px;
            height: 10px;
            background: #FF00FF;
            animation: fall 3s linear infinite;
        }

        @keyframes fall {
            to { transform: translateY(100vh) rotate(360deg); }
        }

        .ending-message {
            text-align: center;
            padding: 40px;
            font-size: 1.3em;
        }

        .ending-message.win {
            background: linear-gradient(135deg, #00ff00 0%, #00aa00 100%);
            color: white;
        }

        .ending-message.lose {
            background: linear-gradient(135deg, #ff0000 0%, #aa0000 100%);
            color: white;
        }

        .documentary-footer {
            background: #FF00FF;
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-top: 30px;
            text-align: center;
        }

        .documentary-footer a {
            color: white;
            text-decoration: underline;
            font-weight: bold;
        }

        .creators-image {
            max-width: 300px;
            margin: 20px auto;
            display: block;
        }

        @media (max-width: 768px) {
            .screen {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .character-grid {
                grid-template-columns: 1fr;
            }
        }

        .sr-only {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        .touchscreen-target {
            width: 80px;
            height: 80px;
            background: #FF00FF;
            border-radius: 50%;
            position: absolute;
            cursor: pointer;
            transition: all 0.3s;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .video-card {
            background: white;
            color: #333;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .video-card:hover, .video-card:focus {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border-color: #FF00FF;
            outline: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen active">
            <h1>The AAC Eligibility Game</h1>
            <h2>Can You Get Specialist Referral?</h2>
            
            <div class="narrator">
                <p>Welcome to the AAC Eligibility Game, where the points are made up and the barriers are real. In this game, you'll navigate the NHS England AAC Decision Chart - the same form speech and language therapists actually use to decide if people deserve specialist communication equipment.</p>
                <p style="margin-top: 15px;">You can play as one of seven perspectives. Six people trying to get referred to a specialist AAC service. Or Miss Smith, the SLT trying to apply the system. Fair warning: most will fail. The system is stacked against them. Want to see why? Pick your perspective.</p>
            </div>

            <button class="btn btn-primary" onclick="game.showCharacterSelect()">
                Start Game
            </button>

            <div class="documentary-footer">
                <h3>About This Game</h3>
                <p>This game promotes <strong>"The Power of Unspoken Voices"</strong> - a future documentary about AAC in the UK created by Kate Caryer (AAC user with athetoid cerebral palsy) and Trist√°n White (videographer with a 35-year interest in AAC and accessibility).</p>
                <img src="data:image/png;base64,PLACEHOLDER_CREATORS_IMAGE" alt="Kate Caryer and Trist√°n White" class="creators-image" id="creators-img">
                <p><a href="https://www.unspokenvoices.co.uk" target="_blank" rel="noopener">Visit www.unspokenvoices.co.uk</a></p>
            </div>
        </div>

        <!-- Character Selection Screen -->
        <div id="character-select-screen" class="screen">
            <h1>Choose Your Perspective</h1>
            
            <div class="narrator">
                <p>Select one of seven perspectives to experience the NHS AAC eligibility assessment system:</p>
            </div>

            <div class="character-grid">
                <div class="character-card" tabindex="0" role="button" onclick="game.selectCharacter('mia')" onkeypress="if(event.key==='Enter') game.selectCharacter('mia')">
                    <div class="character-name">Mia</div>
                    <div class="character-desc">8-year-old girl with cerebral palsy. Uses a picture board. Mum translates her gestures.</div>
                </div>

                <div class="character-card" tabindex="0" role="button" onclick="game.selectCharacter('james')" onkeypress="if(event.key==='Enter') game.selectCharacter('james')">
                    <div class="character-name">James</div>
                    <div class="character-desc">30-year-old man with MND. Uses an alphabet board. Wife helps spell out messages. Time is running out.</div>
                </div>

                <div class="character-card" tabindex="0" role="button" onclick="game.selectCharacter('robert')" onkeypress="if(event.key==='Enter') game.selectCharacter('robert')">
                    <div class="character-name">Robert</div>
                    <div class="character-desc">65-year-old. Had a stroke three months ago. Very few people get specialist AAC shortly after stroke - doctors assume he'll recover his speech.</div>
                </div>

                <div class="character-card" tabindex="0" role="button" onclick="game.selectCharacter('aisha')" onkeypress="if(event.key==='Enter') game.selectCharacter('aisha')">
                    <div class="character-name">Aisha</div>
                    <div class="character-desc">25-year-old woman with autism and intellectual disability. No AAC at all. Local SLT has never offered her anything.</div>
                </div>

                <div class="character-card" tabindex="0" role="button" onclick="game.selectCharacter('kwame')" onkeypress="if(event.key==='Enter') game.selectCharacter('kwame')">
                    <div class="character-name">Kwame</div>
                    <div class="character-desc">19-year-old with severe CP. Had a great AAC device five years ago. Device broke eight months ago and is still waiting for replacement.</div>
                </div>

                <div class="character-card" tabindex="0" role="button" onclick="game.selectCharacter('mrs_chen')" onkeypress="if(event.key==='Enter') game.selectCharacter('mrs_chen')">
                    <div class="character-name">Mrs. Chen</div>
                    <div class="character-desc">72-year-old with severe dysarthria. Speaks Cantonese at home. No bilingual speech and language therapist available. Her son tries to help but isn't trained.</div>
                </div>

                <div class="character-card" tabindex="0" role="button" onclick="game.selectCharacter('miss_smith')" onkeypress="if(event.key==='Enter') game.selectCharacter('miss_smith')">
                    <div class="character-name">Miss Smith (SLT)</div>
                    <div class="character-desc">The Speech and Language Therapist trying to apply the Decision Chart fairly. Watch as she assesses patient after patient and realises the system is broken.</div>
                </div>
            </div>

            <button class="btn" onclick="game.showScreen('welcome-screen')">Back</button>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="office-scene" id="office">
                <img src="data:image/png;base64,PLACEHOLDER_CHART_IMAGE" alt="NHS Decision Chart 2025" class="decision-chart" onclick="game.showChartModal()" tabindex="0" role="button" aria-label="View full decision chart" id="chart-img">
                
                <img src="data:image/png;base64,PLACEHOLDER_NHS_LOGO" alt="NHS Logo" class="nhs-logo" id="nhs-logo-img">

                <div class="hoop" id="hoop" style="display:none;">
                    <div style="text-align:center; color:#333; font-weight:bold; margin-top:85px;">Push Through</div>
                </div>

                <div id="game-content"></div>
            </div>

            <div class="eligibility-metre" id="eligibility-metre-container" style="display:none;">
                <div class="metre-fill" id="metre-fill" style="width: 50%;">
                    <span id="metre-text">Eligibility: 50%</span>
                </div>
            </div>

            <div id="question-content"></div>

            <div id="button-container" style="text-align: center; margin-top: 20px;"></div>
        </div>

        <!-- Ending Screen -->
        <div id="ending-screen" class="screen">
            <div id="ending-content"></div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="game.showCharacterSelect()">Try Another Character</button>
                <button class="btn" onclick="location.reload()">Restart Game</button>
            </div>

            <div class="documentary-footer">
                <h3>Learn More</h3>
                <p>This game is based on real barriers faced by AAC users in the UK healthcare system.</p>
                <p><strong>"The Power of Unspoken Voices"</strong> documentary will explore these issues in depth.</p>
                <p><a href="https://www.unspokenvoices.co.uk" target="_blank" rel="noopener">Visit www.unspokenvoices.co.uk to find out more or help us with our project</a></p>
            </div>
        </div>
    </div>

    <script>
        const game = {
            currentCharacter: null,
            currentQuestion: 0,
            eligibility: 50,
            gameMode: 'patient',
            touchHits: 0,
            touchInterval: null,
            touchTimeout: null,

            characters: {
                mia: {
                    name: 'Mia',
                    age: 8,
                    condition: 'Athetoid Cerebral Palsy',
                    startingEligibility: 65,
                    barriers: [
                        { name: 'Age discrimination', value: -10 },
                        { name: 'Parent translation assumptions', value: -15 }
                    ],
                    ending: 'lose',
                    endingMessage: 'SYSTEMIC DISCRIMINATION - Too young for specialist assessment despite severe need. System assumes children will "grow out of it" or that parent translation is sufficient. Mia denied specialist referral.'
                },
                james: {
                    name: 'James',
                    age: 30,
                    condition: 'Motor Neurone Disease (MND)',
                    startingEligibility: 75,
                    barriers: [
                        { name: 'System too slow for rapid deterioration', value: -15 }
                    ],
                    ending: 'win',
                    endingMessage: 'URGENT CASE - James receives specialist referral due to rapidly degenerative condition. However, funding delays mean equipment may not arrive before he loses physical access abilities. Time is critical.'
                },
                robert: {
                    name: 'Robert',
                    age: 65,
                    condition: 'Stroke survivor (3 months post-stroke)',
                    startingEligibility: 60,
                    barriers: [
                        { name: 'Recovery assumption', value: -15 },
                        { name: 'Age-based triage', value: -10 }
                    ],
                    ending: 'lose',
                    endingMessage: 'FALLS THROUGH CRACK - System assumes Robert will recover his speech naturally. Specialist AAC denied despite severe communication difficulties. Left with inadequate low-tech options.'
                },
                aisha: {
                    name: 'Aisha',
                    age: 25,
                    condition: 'Autism and Intellectual Disability',
                    startingEligibility: 60,
                    barriers: [
                        { name: 'Intellectual disability bias', value: -20 },
                        { name: 'Lack of previous AAC trials', value: -10 }
                    ],
                    ending: 'lose',
                    endingMessage: 'SYSTEMIC DISCRIMINATION - Intellectual disability interpreted as inability to benefit from AAC rather than need for it. No previous AAC provision means cannot meet eligibility criteria. Vicious circle.'
                },
                kwame: {
                    name: 'Kwame',
                    age: 19,
                    condition: 'Severe Cerebral Palsy',
                    startingEligibility: 65,
                    barriers: [
                        { name: 'Equipment breakdown delays', value: -10 },
                        { name: 'Transition from children to adult services', value: -15 }
                    ],
                    ending: 'lose',
                    endingMessage: 'FALLS THROUGH CRACK - Device broken for 8 months. Transition from children\'s to adult services caused delays. Despite previous successful AAC use, replacement denied. Communication regressed significantly.'
                },
                mrs_chen: {
                    name: 'Mrs. Chen',
                    age: 72,
                    condition: 'Severe dysarthria',
                    startingEligibility: 60,
                    barriers: [
                        { name: 'Language barrier (no bilingual SLT)', value: -10 },
                        { name: 'Culturally inappropriate AAC', value: -8 },
                        { name: 'Untrained family support', value: -12 }
                    ],
                    ending: 'lose',
                    endingMessage: 'SYSTEMIC DISCRIMINATION - System cannot accommodate non-English speaker with severe dysarthria. No bilingual SLT available. Son tries but isn\'t trained. Critical communication goals lost through translation gaps. Mrs. Chen left with inadequate English-only picture cards.'
                },
                miss_smith: {
                    name: 'Miss Smith',
                    role: 'Speech and Language Therapist',
                    gameMode: 'slt',
                    endingMessage: 'SLT PERSPECTIVE - You\'ve seen the system from the inside. The Decision Chart creates impossible barriers. Patients with genuine need are denied. You\'re frustrated but powerless to change the criteria. The system is broken.'
                }
            },

            assessmentQuestions: [
                {
                    id: 1,
                    text: 'Does the person require a specialist assessment because they have a severe/complex communication difficulty associated with a range of physical and/or cognitive impairments?',
                    chartSection: 'Question 1'
                },
                {
                    id: 2,
                    text: 'Has the person developed beyond cause and effect understanding?',
                    chartSection: 'Question 2',
                    miniGame: 'cause_effect'
                },
                {
                    id: 3,
                    text: 'Is the person able to understand the purpose of a communication aid?',
                    chartSection: 'Question 3'
                },
                {
                    id: 4,
                    text: 'Is there a clear and evidenced discrepancy between the person\'s level of linguistic understanding and their ability to use biological speech?',
                    chartSection: 'Question 4'
                },
                {
                    id: 5,
                    text: 'Have "low-tech" strategies and techniques been tried or considered, and are there identified reasons why such methods are insufficient to meet the person\'s communication needs?',
                    chartSection: 'Question 5',
                    miniGame: 'video_hunt'
                },
                {
                    id: 6,
                    text: 'How is the person likely to use high-tech or low-tech AAC in terms of language competence?',
                    chartSection: 'Question 6',
                    pathways: true
                },
                {
                    id: 7,
                    text: 'Can the person select items on a touch screen or keyboard with sufficient speed and endurance?',
                    chartSection: 'Question 7',
                    miniGame: 'touchscreen'
                }
            ],

            showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById(screenId).classList.add('active');
            },

            showCharacterSelect() {
                this.showScreen('character-select-screen');
            },

            selectCharacter(charId) {
                this.currentCharacter = this.characters[charId];
                this.eligibility = this.currentCharacter.startingEligibility || 50;
                this.currentQuestion = 0;
                
                if (this.currentCharacter.gameMode === 'slt') {
                    this.gameMode = 'slt';
                    this.startSLTMode();
                } else {
                    this.gameMode = 'patient';
                    this.startPatientMode();
                }
            },

            startPatientMode() {
                this.showScreen('game-screen');
                document.getElementById('eligibility-metre-container').style.display = 'block';
                document.getElementById('question-content').innerHTML = '';
                this.updateMetre();
                
                document.getElementById('hoop').style.display = 'block';
                document.getElementById('game-content').innerHTML = `
                    <div class="dialogue">
                        <div class="speaker">Narrator</div>
                        <p>Welcome to Anywhere NHS Trust Local SLT Service. Notice the metaphorical hoop you must jump through? It's comically small. But that's the system.</p>
                    </div>
                    <div class="dialogue">
                        <div class="speaker">${this.currentCharacter.name}</div>
                        <p>*Approaches Miss Smith's desk through the undersized hoop*</p>
                    </div>
                `;
                
                document.getElementById('button-container').innerHTML = `
                    <button class="btn btn-primary" onclick="game.startAssessment()">Begin Assessment</button>
                `;
            },

            startSLTMode() {
                this.showScreen('game-screen');
                document.getElementById('game-content').innerHTML = `
                    <div class="dialogue">
                        <div class="speaker">Narrator</div>
                        <p>You are Miss Smith, a dedicated Speech and Language Therapist. You'll assess six patients today using the NHS Decision Chart. You want to help everyone, but the system has other ideas.</p>
                    </div>
                `;
                
                document.getElementById('button-container').innerHTML = `
                    <button class="btn btn-primary" onclick="game.startSLTAssessments()">Begin Assessments</button>
                `;
            },

            startSLTAssessments() {
                document.getElementById('game-content').innerHTML = `
                    <div class="dialogue">
                        <div class="speaker">Miss Smith</div>
                        <p>Right, let me consult the Decision Chart for my first patient today...</p>
                    </div>
                    <div class="narrator">
                        <p>SLT Mode: You'll see how the system denies patients despite clear need. This mode is under development in this version.</p>
                    </div>
                `;
                
                document.getElementById('button-container').innerHTML = `
                    <button class="btn" onclick="game.showEnding()">See System Overview</button>
                `;
            },

            startAssessment() {
                document.getElementById('hoop').style.display = 'none';
                this.askQuestion();
            },

            askQuestion() {
                if (this.currentQuestion >= this.assessmentQuestions.length) {
                    this.showEnding();
                    return;
                }

                const question = this.assessmentQuestions[this.currentQuestion];
                
                document.getElementById('question-content').innerHTML = `
                    <div class="question-box">
                        <h3 style="color: #003D7A;">Question ${this.currentQuestion + 1} of ${this.assessmentQuestions.length}</h3>
                        <p style="font-size: 1.1em; margin: 15px 0;">${question.text}</p>
                        <p style="font-style: italic; color: #666;">Chart Section: ${question.chartSection}</p>
                    </div>
                `;

                const characterResponse = this.getCharacterResponse(this.currentCharacter, question.id);
                
                document.getElementById('game-content').innerHTML = `
                    <div class="dialogue">
                        <div class="speaker">Miss Smith</div>
                        <p>${question.text}</p>
                    </div>
                    <div class="dialogue">
                        <div class="speaker">${this.currentCharacter.name}</div>
                        <p>${characterResponse}</p>
                    </div>
                `;

                if (question.miniGame) {
                    this.loadMiniGame(question.miniGame);
                } else {
                    this.showQuestionButtons(question);
                }
            },

            getCharacterResponse(char, questionId) {
                const responses = {
                    mia: {
                        1: '*Mum gestures* "She understands everything, but can\'t speak clearly. She needs help."',
                        2: 'Yes, Mia understands cause and effect - she knows when she pushes a button, something happens.',
                        3: '*Points excitedly at communication device* "She knows what it\'s for!"',
                        4: 'Mia understands complex language but her speech is unintelligible due to athetoid movements.',
                        5: '*Holds up worn picture board* "We\'ve been using this for years. It\'s not enough anymore."',
                        6: 'Mia can combine symbols to create messages - she needs more than single-concept selection.',
                        7: '*Struggles with touchscreen due to involuntary movements*'
                    },
                    james: {
                        1: '*Uses alphabet board slowly* Y-E-S... S-E-V-E-R-E... M-N-D',
                        2: 'James has full cognitive abilities. MND affects motor function, not understanding.',
                        3: '*Points to current alphabet board* "I know exactly what I need. Time is running out."',
                        4: 'James has perfect linguistic understanding but cannot speak due to bulbar dysfunction.',
                        5: '*Wife holds up alphabet board* "This works but it\'s too slow. He needs high-tech AAC now."',
                        6: 'James can construct novel messages - he\'s a university graduate with full literacy.',
                        7: '*Hand trembles as he tries to touch screen* "Getting harder each week..."'
                    },
                    robert: {
                        1: '*Nods vigorously but cannot form words* "Mmm... mmm..."',
                        2: 'Robert understands everything - the stroke affected his speech output, not comprehension.',
                        3: '*Points to pictures desperately* Trying to communicate "YES!"',
                        4: 'Clear discrepancy - Robert has intact language understanding but cannot produce speech.',
                        5: '*Holds up basic picture cards* "These... not... enough..."',
                        6: 'Robert was fully literate before stroke - he needs literacy-based AAC.',
                        7: '*Right hand affected by stroke - tries to use left hand on touchscreen*'
                    },
                    aisha: {
                        1: '*Looks anxious, rocks slightly* Aisha clearly has communication difficulties.',
                        2: '*Mother explains* "She understands cause and effect - she knows actions have results."',
                        3: '*Reaches for communication device with interest*',
                        4: 'Aisha understands more than she can express verbally. She needs AAC support.',
                        5: '*Mother frustrated* "No one has ever offered her anything. We don\'t know what to try."',
                        6: 'Aisha uses pictures and symbols - she needs symbol-based AAC to develop further.',
                        7: '*Carefully touches screen - can physically access but needs symbol-based vocabulary*'
                    },
                    kwame: {
                        1: '*Uses eye gaze to look at broken device* "Had... one... before..."',
                        2: 'Kwame has sophisticated understanding - he used complex AAC successfully for years.',
                        3: '*Eyes light up at mention of communication aid* "Need... my... voice... back..."',
                        4: 'Kwame cannot produce intelligible speech. His previous AAC was his primary communication.',
                        5: '*Device remains broken after 8 months* "Been... waiting... so... long..."',
                        6: 'Kwame previously used multi-page vocabulary to construct complex messages.',
                        7: '*Physical access has changed - old device mounting no longer works*'
                    },
                    mrs_chen: {
                        1: '*Son translates from Cantonese* "Mother has severe dysarthria. Speech very unclear."',
                        2: '*Nods vigorously - clearly understands* Son: "She understands everything in Cantonese."',
                        3: '*Points to picture cards with frustration* Son: "She knows what AAC is, but these cards are in English."',
                        4: '*Speaks in Cantonese - unintelligible due to dysarthria* Son: "Her mind is sharp, but speech is very difficult."',
                        5: '*Holds up English picture cards* Son: "These don\'t work - they\'re not in her language."',
                        6: 'Son: "Mother is literate in Cantonese. She needs Cantonese vocabulary."',
                        7: '*Hand coordination affected by dysarthria-related condition*'
                    }
                };

                const charKey = char.name.toLowerCase().replace(/ /g, '_');
                return responses[charKey]?.[questionId] || 'Response to assessment question.';
            },

            showQuestionButtons(question) {
                const impact = this.calculateQuestionImpact(this.currentCharacter, question.id);
                
                document.getElementById('button-container').innerHTML = `
                    <button class="btn btn-primary" onclick="game.answerQuestion(${impact})">
                        Continue Assessment
                    </button>
                `;
            },

            calculateQuestionImpact(char, questionId) {
                const impacts = {
                    mia: [-3, 0, -5, 0, -8, -5, -8],
                    james: [0, 0, 0, 0, 2, 3, -10],
                    robert: [-5, 0, -5, 0, -8, -3, -5],
                    aisha: [-8, -5, -8, -5, -8, 0, 0],
                    kwame: [-5, 0, -5, -3, -5, 0, -8],
                    mrs_chen: [-3, 0, -5, -3, -8, -5, -8]
                };

                const charKey = char.name.toLowerCase().replace(/ /g, '_');
                return impacts[charKey]?.[questionId - 1] || -3;
            },

            loadMiniGame(gameType) {
                let miniGameHTML = '';

                switch(gameType) {
                    case 'touchscreen':
                        miniGameHTML = `
                            <div class="mini-game">
                                <h3 style="color: white;">MINI-GAME: Touchscreen Assessment</h3>
                                <p>Physical access testing: Can ${this.currentCharacter.name} accurately hit moving targets on a touchscreen?</p>
                                <p style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 5px; margin: 10px 0;"><strong>Click the moving pink target 5 times to complete the test.</strong> You have 20 seconds. Note: Even if you succeed, eligibility may still decrease due to speed/endurance concerns.</p>
                                <div style="position: relative; height: 300px; background: rgba(255,255,255,0.2); border-radius: 10px; margin: 20px 0;">
                                    <div id="touch-target" class="touchscreen-target" onclick="game.hitTarget()"></div>
                                </div>
                                <p id="touch-score" style="font-size: 1.3em; font-weight: bold;">Hits: 0/5 | Time: <span id="time-remaining">20</span>s</p>
                            </div>
                        `;
                        break;

                    case 'video_hunt':
                        const hasVideo = this.currentCharacter.name === 'James' || this.currentCharacter.name === 'Kwame';
                        miniGameHTML = `
                            <div class="mini-game">
                                <h3 style="color: white;">MINI-GAME: Video Evidence Hunt</h3>
                                <p>The system requires video evidence of communication attempts. Click on videos to see if they're acceptable.</p>
                                <p style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 5px; margin: 10px 0;"><strong>Problem:</strong> If no acceptable clinical video exists, eligibility is reduced. Most real communication happens at home, but home videos aren't considered "clinical evidence."</p>
                                <div class="video-grid">
                                    <div class="video-card" tabindex="0" role="button" onclick="game.selectVideo(false)" onkeypress="if(event.key==='Enter') game.selectVideo(false)">
                                        <div style="background: #ddd; height: 100px; margin-bottom: 10px; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 3em;">üìπ</div>
                                        <p><strong>Click to try:</strong><br>"Home video"</p>
                                    </div>
                                    <div class="video-card" tabindex="0" role="button" onclick="game.selectVideo(false)" onkeypress="if(event.key==='Enter') game.selectVideo(false)">
                                        <div style="background: #ddd; height: 100px; margin-bottom: 10px; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 3em;">üìπ</div>
                                        <p><strong>Click to try:</strong><br>"Family footage"</p>
                                    </div>
                                    <div class="video-card" tabindex="0" role="button" onclick="game.selectVideo(${hasVideo})" onkeypress="if(event.key==='Enter') game.selectVideo(${hasVideo})">
                                        <div style="background: #ddd; height: 100px; margin-bottom: 10px; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 3em;">üìπ</div>
                                        <p><strong>Click to try:</strong><br>"Clinical assessment"</p>
                                    </div>
                                    <div class="video-card" tabindex="0" role="button" onclick="game.selectVideo(false)" onkeypress="if(event.key==='Enter') game.selectVideo(false)">
                                        <div style="background: #ddd; height: 100px; margin-bottom: 10px; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 3em;">üìπ</div>
                                        <p><strong>Click to try:</strong><br>"School recording"</p>
                                    </div>
                                </div>
                            </div>
                        `;
                        break;

                    case 'cause_effect':
                        miniGameHTML = `
                            <div class="mini-game">
                                <h3 style="color: white;">MINI-GAME: Cause & Effect Understanding</h3>
                                <p>Demonstrate understanding that actions cause results.</p>
                                <div style="text-align: center; margin: 30px 0;">
                                    <button class="btn" style="font-size: 2em; padding: 30px 60px;" onclick="game.causeEffectDemo()">
                                        Press Me
                                    </button>
                                    <p id="effect-result" style="margin-top: 20px; font-size: 1.5em; color: white;"></p>
                                </div>
                            </div>
                        `;
                        break;
                }

                document.getElementById('game-content').innerHTML += miniGameHTML;
                
                if (gameType === 'touchscreen') {
                    this.startTouchscreenGame();
                }
            },

            startTouchscreenGame() {
                this.touchHits = 0;
                let timeRemaining = 20;
                
                this.moveTarget();
                this.touchInterval = setInterval(() => this.moveTarget(), 1500);
                
                const countdown = setInterval(() => {
                    timeRemaining--;
                    const timeElem = document.getElementById('time-remaining');
                    if (timeElem) {
                        timeElem.textContent = timeRemaining;
                    }
                    
                    if (timeRemaining <= 0) {
                        clearInterval(countdown);
                        clearInterval(this.touchInterval);
                        setTimeout(() => {
                            const impact = this.currentCharacter.name === 'James' ? -10 : -12;
                            this.answerQuestion(impact);
                        }, 500);
                    }
                }, 1000);
                
                this.touchTimeout = countdown;
            },

            moveTarget() {
                const target = document.getElementById('touch-target');
                if (!target) return;
                
                const container = target.parentElement;
                const maxX = container.offsetWidth - 80;
                const maxY = container.offsetHeight - 80;
                
                const x = Math.random() * maxX;
                const y = Math.random() * maxY;
                
                target.style.left = x + 'px';
                target.style.top = y + 'px';
            },

            hitTarget() {
                this.touchHits++;
                const scoreElem = document.getElementById('touch-score');
                if (scoreElem) {
                    const timeElem = document.getElementById('time-remaining');
                    const time = timeElem ? timeElem.textContent : '?';
                    scoreElem.innerHTML = `Hits: ${this.touchHits}/5 | Time: <span id="time-remaining">${time}</span>s`;
                }
                
                if (this.touchHits >= 5) {
                    clearInterval(this.touchInterval);
                    clearInterval(this.touchTimeout);
                    setTimeout(() => {
                        const impact = this.currentCharacter.name === 'James' ? -10 : -12;
                        this.answerQuestion(impact);
                    }, 1000);
                }
            },

            selectVideo(isCorrect) {
                if (isCorrect) {
                    alert('Video accepted - Clinical assessment video found! This helps meet the documentation requirements, though eligibility may still decrease due to other factors.');
                    this.answerQuestion(-5);
                } else {
                    alert('Video rejected - System only accepts specific clinical documentation. Real-world communication evidence doesn\'t count. This significantly impacts eligibility.');
                    this.answerQuestion(-15);
                }
            },

            causeEffectDemo() {
                document.getElementById('effect-result').textContent = '‚ú® Effect achieved! ‚ú®';
                setTimeout(() => {
                    this.answerQuestion(0);
                }, 1500);
            },

            answerQuestion(impact) {
                this.eligibility += impact;
                if (this.eligibility > 100) this.eligibility = 100;
                if (this.eligibility < 0) this.eligibility = 0;
                
                this.updateMetre();
                
                if (impact < 0) {
                    this.showImpactMessage(impact);
                }
                
                setTimeout(() => {
                    this.currentQuestion++;
                    this.askQuestion();
                }, 2000);
            },

            showImpactMessage(impact) {
                const message = document.createElement('div');
                message.className = 'dialogue';
                message.style.background = '#ffebee';
                message.style.borderLeft = '4px solid #ff0000';
                message.innerHTML = `
                    <div class="speaker">Miss Smith</div>
                    <p>Eligibility reduced by ${Math.abs(impact)}%. The system's criteria are harsh...</p>
                `;
                document.getElementById('game-content').appendChild(message);
            },

            updateMetre() {
                const metreFill = document.getElementById('metre-fill');
                const metreText = document.getElementById('metre-text');
                
                metreFill.style.width = this.eligibility + '%';
                metreText.textContent = `Eligibility: ${this.eligibility}%`;
                
                const announcement = document.createElement('div');
                announcement.className = 'sr-only';
                announcement.setAttribute('role', 'status');
                announcement.setAttribute('aria-live', 'polite');
                announcement.textContent = `Eligibility now at ${this.eligibility} percent`;
                document.body.appendChild(announcement);
                setTimeout(() => announcement.remove(), 1000);
            },

            showEnding() {
                this.showScreen('ending-screen');
                
                const endingContent = document.getElementById('ending-content');
                
                if (this.gameMode === 'slt') {
                    endingContent.innerHTML = `
                        <div class="ending-message" style="background: #764ba2; color: white;">
                            <h2>System Perspective Complete</h2>
                            <p>${this.currentCharacter.endingMessage}</p>
                        </div>
                    `;
                    return;
                }

                let isWin = this.eligibility >= 60;
                
                if (this.currentCharacter.name === 'James') {
                    isWin = true;
                }

                if (isWin) {
                    this.createConfetti();
                    endingContent.innerHTML = `
                        <div class="ending-message win">
                            <h2 style="color: white;">üéâ SPECIALIST REFERRAL APPROVED! üéâ</h2>
                            <p style="font-size: 1.3em; margin: 20px 0;">Final Eligibility: ${this.eligibility}%</p>
                            <p>${this.currentCharacter.endingMessage}</p>
                        </div>
                        <div class="narrator">
                            <p><strong>Important Note:</strong> Even with approval, ${this.currentCharacter.name} faces:</p>
                            <ul style="margin: 15px 0; text-align: left;">
                                <li>Funding delays (6-18 months typical)</li>
                                <li>Equipment procurement bureaucracy</li>
                                <li>Training requirements</li>
                                <li>Ongoing technical support gaps</li>
                            </ul>
                            <p>Approval is just the first hurdle. The real barriers begin now.</p>
                        </div>
                    `;
                } else {
                    endingContent.innerHTML = `
                        <div class="ending-message lose">
                            <h2 style="color: white;">‚ùå REFERRAL DENIED</h2>
                            <p style="font-size: 1.3em; margin: 20px 0;">Final Eligibility: ${this.eligibility}%</p>
                            <p>Required: 60% minimum</p>
                        </div>
                        <div class="narrator" style="background: #ffebee; border-left-color: #ff0000;">
                            <h3 style="color: #ff0000;">System Failure Analysis</h3>
                            <p style="font-weight: bold; margin-bottom: 15px;">${this.currentCharacter.endingMessage}</p>
                            <p><strong>Barriers Faced:</strong></p>
                            <ul style="margin: 15px 0; text-align: left;">
                                ${this.currentCharacter.barriers.map(b => `<li>${b.name}: ${b.value}%</li>`).join('')}
                            </ul>
                            <p style="margin-top: 20px; font-style: italic;">This outcome reflects real systemic barriers in the NHS AAC provision system. ${this.currentCharacter.name}'s communication rights have been denied not due to lack of need, but due to systemic discrimination.</p>
                        </div>
                    `;
                }
            },

            createConfetti() {
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + '%';
                        confetti.style.background = ['#FF00FF', '#00ff00', '#ffff00', '#00ffff'][Math.floor(Math.random() * 4)];
                        confetti.style.animationDelay = Math.random() * 3 + 's';
                        document.body.appendChild(confetti);
                        setTimeout(() => confetti.remove(), 3000);
                    }, i * 100);
                }
            },

            showChartModal() {
                alert('NHS Decision Chart 2025\n\nThis chart contains the actual criteria used by SLTs to assess AAC eligibility. Each question represents a potential barrier.\n\nClick to view the full chart in the top-left corner of the office.');
            }
        };

        // Load images when page loads
        window.addEventListener('load', () => {
            // You'll need to replace these with actual base64 data or file paths
            console.log('AAC Eligibility Game loaded successfully. Ready to play.');
            console.log('Note: Replace placeholder images with actual PNG files.');
        });
    </script>
</body>
</html>